<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TPS-DPS</title>
    <link rel="stylesheet" type="text/css" href="page/style.css" />
    <style>
      body {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 100px;
        text-align: left;
      }

      h1 {
        text-align: center;
        font-size: 2.5em;
        margin-bottom: 20px;
        color: #000000;
      }

      h2 {
        text-align: center;
        font-size: 2em;
        margin-bottom: 20px;
        color: #000000;
      }

      h3 {
        text-align: center;
        font-size: 1.5em;
        margin-bottom: 20px;
        color: #000000;
      }

      .flex-container h3 {
        flex: 0 0 300px;
      }

      p.caption {
        font-size: 1.2em;
        margin-left: 10%;
        margin-right: 10%;
        margin-bottom: 30px;
        color: grey;
      }

      p.intro {
        margin-left: 20%;
        margin-right: 20%;
        margin-bottom: 30px;
      }

      .gif-container {
        display: flex;
        justify-content: space-around;
        margin-bottom: 30px;
        width: 1300px;
      }

      .gif-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 250px;
        justify-content: space-between;
      }

      .gif-item img {
        max-width: 500px;
        max-height: 100%;
        object-fit: contain;
        width: auto;
      }

      .gif-item p {
        text-align: center;
        margin: 5px 0;
      }

      .img-item img {
        max-width: 300px;
        max-height: 100%;
        object-fit: contain;
        width: auto;
      }

      .img-item p {
        text-align: center;
        margin: 5px 0;
      }

      .flex-container {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      h3 {
        margin-right: 20px;
      }
    </style>
  </head>
  <body>
    <script src="./page/ngl.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        stage_alanine = new NGL.Stage("viewport-alanine");
        stage_alanine.setParameters({ backgroundColor: "white" });
        stage_alanine
          .loadFile("./page/data/alanine-path.gro", {
            defaultRepresentation: true,
            asTrajectory: true,
          })
          .then(function (comp) {
            comp.setName("simulation-alanine");
            comp.addTrajectory();
          });

        var toggleSpin_alanine = document.getElementById("toggleSpin-alanine");
        var isSpinning_alanine = false;
        toggleSpin_alanine.addEventListener("click", function () {
          if (!isSpinning_alanine) {
            stage_alanine.setSpin([0, 1, 0], 0.01);
            isSpinning_alanine = true;
          } else {
            stage_alanine.setSpin(null, null);
            isSpinning_alanine = false;
          }
        });

        var toggleRunMDs_alanine = document.getElementById(
          "toggleRunMDs-alanine"
        );
        var isRunning_alanine = false;
        toggleRunMDs_alanine.addEventListener("click", function () {
          var trajComp_alanine =
            stage_alanine.getComponentsByName("simulation-alanine").list[0]
              .trajList[0];
          var player_alanine = new NGL.TrajectoryPlayer(
            trajComp_alanine.trajectory,
            { step: 40, mode: "once", interpolateType: "spline", timeout: 200 }
          );
          if (!isRunning_alanine) {
            player_alanine.play();
            isRunning_alanine = true;
          } else {
            player_alanine.play();
            player_alanine.pause();
            isRunning_alanine = false;
          }
        });


        stage_poly = new NGL.Stage("viewport-poly");
        stage_poly.setParameters({ backgroundColor: "white" });
        stage_poly
          .loadFile("./page/data/poly-path.gro", {
            defaultRepresentation: true,
            asTrajectory: true,
          })
          .then(function (comp) {
            comp.setName("simulation-poly");
            comp.addRepresentation("ball+stick", {
              type: "protein",
              aspectRatio: 1.8,
              radius: 0.2,
            });
            comp.addRepresentation("ball+stick", {
              type: "protein",
              aspectRatio: 11,
              radius: 0.5,
              selection: [6, 16, 18, 20, 30, 32, 34, 44],
              color: "#3FA796",
            });
            comp.addTrajectory();
          });

        var toggleSpin_poly = document.getElementById("toggleSpin-poly");
        var isSpinning_poly = false;
        toggleSpin_poly.addEventListener("click", function () {
          if (!isSpinning_poly) {
            stage_poly.setSpin([0, 1, 0], 0.01);
            isSpinning_poly = true;
          } else {
            stage_poly.setSpin(null, null);
            isSpinning_poly = false;
          }
        });

        var toggleRunMDs_poly = document.getElementById("toggleRunMDs-poly");
        var isRunning_poly = false;
        toggleRunMDs_poly.addEventListener("click", function () {
          var trajComp_poly =
            stage_poly.getComponentsByName("simulation-poly").list[0]
              .trajList[0];
          var player_poly = new NGL.TrajectoryPlayer(trajComp_poly.trajectory, {
            step: 60,
            mode: "once",
            interpolateType: "spline",
            timeout: 200,
          });
          if (!isRunning_poly) {
            player_poly.play();
            isRunning_poly = true;
          } else {
            player_poly.play();
            player_poly.pause();
            isRunning_poly = false;
          }
        });


        stage_chignolin = new NGL.Stage("viewport-chignolin");
        stage_chignolin.setParameters({ backgroundColor: "white" });
        stage_chignolin
          .loadFile("./page/data/chignolin-path.gro", {
            defaultRepresentation: true,
            asTrajectory: true,
          })
          .then(function (comp) {
            comp.setName("simulation-chignolin");
            comp.addRepresentation("ball+stick", {
              aspectRatio: 1.0,
              radius: 0.15,
            });
            comp.addRepresentation("distance", {
              atom_pair: [[37, 76]],
              color: "#FEC220",
              background: "#FEC220",
              linewidth: 12.0,
              useCylinder: TRUE,
              radius: 0.3,
              label_size: 0,
            });
            comp.addTrajectory();
          });

        var toggleSpin_chignolin = document.getElementById(
          "toggleSpin-chignolin"
        );
        var isSpinning_chignolin = false;
        toggleSpin_chignolin.addEventListener("click", function () {
          if (!isSpinning_chignolin) {
            stage_chignolin.setSpin([0, 1, 0], 0.01);
            isSpinning_chignolin = true;
          } else {
            stage_chignolin.setSpin(null, null);
            isSpinning_chignolin = false;
          }
        });

        var toggleRunMDs_chignolin = document.getElementById(
          "toggleRunMDs-chignolin"
        );
        var isRunning_chignolin = false;
        toggleRunMDs_chignolin.addEventListener("click", function () {
          var trajComp_chignolin = stage_chignolin.getComponentsByName(
            "simulation-chignolin"
          ).list[0].trajList[0];
          var player_chignolin = new NGL.TrajectoryPlayer(
            trajComp_chignolin.trajectory,
            { step: 80, mode: "once", interpolateType: "spline", timeout: 200 }
          );
          if (!isRunning_chignolin) {
            player_chignolin.play();
            isRunning_chignolin = true;
          } else {
            player_chignolin.play();
            player_chignolin.pause();
            isRunning_chignolin = false;
          }
        });
      });
    </script>
    <h1>
      Transition Path Sampling
      <br />
      with Improved Off-Policy Training of Diffusion Path Samplers
    </h1>
    <h2>TL;DR</h2>
    <p class="intro"></p>
    <ul>
      <li>
        We propose <strong>TPS-DPS</strong>, sampling transition pathways
        without the need for collective variables (CVs).
      </li>
      <li>
        TPS-DPS minimize the <strong>log-variance divergence</strong> between
        the path measure induced by the model and the target path measure.
      </li>
      <li>
        We introduce a new off-policy training objective based on learned
        control variates and replay buffers.
      </li>
      <li>
        We introduce a new scale-based equivariant parameterization for bias
        force.
      </li>
    </ul>
    <h2>Abstract</h2>
    <p class="intro">
      Understanding transition pathways between metastable states in molecular
      systems is crucial to advance material design and drug discovery. However,
      unbiased molecular dynamics simulations are computationally infeasible due
      to the high energy barriers separating these states. Although recent
      machine learning techniques offer potential solutions, they are often
      limited to simple systems or rely on collective variables (CVs) derived
      from costly domain expertise. In this paper, we introduce a novel approach
      that trains diffusion path samplers (DPS) to sample transition pathways
      without the need for CVs. We recast the problem as an amortized sampling
      of the target path measure, minimizing the log-variance divergence between
      the path measure induced by DPS and the target path measure. To ensure
      scalability to high-dimensional tasks, we introduce a new off-policy
      training objective based on learned control variates and replay buffers,
      and a scale-based parameterization of the bias forces. Our approach,
      termed TPS-DPS, is evaluated on a synthetic double-well potential and
      three proteins: Alanine Dipeptide, Polyproline Helix, and Chignolin.
      Results show that our approach produces more realistic and diverse
      transition pathways compared to existing CV-free methods.
    </p>
    <br />
    <h2>Transition path sampled from TPS-DPS</h2>
    <ul>
      <li>
        We evaluate TPS-DPS on the synthetic double-well potential and three
        real-world molecular systems: Alanine Dipeptide, Polyproline Helix, and
        Chignolin.
      </li>
      <li>
        For the Double-well system, we plot the potential energy landscape
        modified by the neural bias potential.
      </li>
      <li>
        For real-world molecular systems, we plot the initial and target state,
        and the transition state sampled from TPS-DPS in video.
      </li>
    </ul>
    <br />
    <div class="flex-container">
      <h3>Double-well<br />system</h3>
      <div class="gif-container">
        <div class="gif-item">
          <img
            src="figures/synthetic-md.gif"
            alt="Double-Well unbiased MD"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Unbiased MD</p>
        </div>
        <div class="gif-item">
          <img
            src="figures/synthetic-tps-dps.gif"
            alt="Double-Well TPS-DPS"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>TPS-DPS</p>
        </div>
      </div>
    </div>
    <br />
    <div class="flex-container">
      <h3>Alanine<br />Dipeptide</h3>
      <div class="gif-container">
        <div class="gif-item">
          <img
            src="figures/alanine-c5.png"
            alt="Alanine initial state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Initial state (C5)</p>
        </div>
        <div class="gif-item">
          <div id="viewport-alanine" style="width:250px; height:250px; margin:0 auto;"></div>
          <p>Sampled transition (conformation change)</p>
          <div
            style="
              display: flex;
              gap: 10px;
              align-items: center;
              justify-content: center;
            "
          >
            <button id="toggleSpin-alanine">Spin on/off</button>
            <button id="toggleRunMDs-alanine">Run/pause MD</button>
          </div>
        </div>
        <div class="gif-item">
          <img
            src="figures/alanine-c7ax.png"
            alt="Alanine target state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Target state (C7ax)</p>
        </div>
      </div>
    </div>
    <br />
    <div class="flex-container">
      <h3>Polyproline<br />Helix</h3>
      <div class="gif-container">
        <div class="gif-item">
          <img
            src="figures/poly-pp2.png"
            alt="Poly start state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Initial state (left-handed, PP-II)</p>
        </div>
        <div class="gif-item">
          <div id="viewport-poly" style="width:250px; height:250px; margin:0 auto;"></div>
          <p>Sampled transition (isomerization)</p>
          <div
            style="
              display: flex;
              gap: 10px;
              align-items: center;
              justify-content: center;
            "
          >
            <button id="toggleSpin-poly">Spin on/off</button>
            <button id="toggleRunMDs-poly">Run/pause MD</button>
          </div>
        </div>
        <div class="gif-item">
          <img
            src="figures/poly-pp1.png"
            alt="Poly target state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Target state (right-handed, PP-I)</p>
        </div>
      </div>
    </div>
    <br />
    <div class="flex-container">
      <h3>Chignolin</h3>
      <div class="gif-container">
        <div class="gif-item">
          <img
            src="figures/chignolin-unfolded.png"
            alt="Chignolin initial state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Initial state (unfolded)</p>
        </div>
        <div class="gif-item">
          <div id="viewport-chignolin" style="width:250px; height:250px; margin:0 auto;"></div>
          <p>Sampled transition (folding)</p>
          <div
            style="
              display: flex;
              gap: 10px;
              align-items: center;
              justify-content: center;
            "
          >
            <button id="toggleSpin-chignolin">Spin on/off</button>
            <button id="toggleRunMDs-chignolin">Run/pause MD</button>
          </div>
        </div>
        <div class="gif-item">
          <img
            src="figures/chignolin-folded.png"
            alt="Chignolin target state"
            style="display: block; margin: 0 auto; max-width: 400px"
          />
          <p>Target state (folded)</p>
        </div>
      </div>
    </div>
    <br />
    <h2>Comparsions with baselines</h2>
    <ul>
      <li>We compared TPS-DPS with both non-ML and ML baselines.</li>
      <li>
        For non-ML baselines, we consider steered MD (SMD) with force constant.
      </li>
      <li>
        For ML baselines, we consider Path Integral SOC for Path Sampling
        (PIPS).
      </li>
    </ul>
    <br />
    <div class="flex-container">
      <h3>Double-well<br />system</h3>
      <div class="gif-container">
        <div class="img-item">
          <p>Unbiased MD</p>
          <img
            src="figures/synthetic-potential-md.png"
            alt="Unbiased MD"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (0.5)</p>
          <img
            src="figures/synthetic-potential-smd0.5.png"
            alt="SMD (0.5)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (1)</p>
          <img
            src="figures/synthetic-potential-smd1.png"
            alt="SMD (1)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (F)</p>
          <img
            src="figures/synthetic-potential-tps-dps-f.png"
            alt="TPS-DPS (F)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (P)</p>
          <img
            src="figures/synthetic-potential-tps-dps-p.png"
            alt="TPS-DPS (P)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>Ground Truth</p>
          <img
            src="figures/synthetic-potential-gt.png"
            alt="Ground Truth"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
      </div>
    </div>
    <br />
    <div class="flex-container">
      <h3>Alanine<br />Dipeptide</h3>
      <div class="gif-container">
        <div class="img-item">
          <p>Unbiased MD</p>
          <img
            src="figures/alanine-ram-md.png"
            alt="Unbiased MD"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (10)</p>
          <img
            src="figures/alanine-ram-smd10.png"
            alt="SMD (10)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (20)</p>
          <img
            src="figures/alanine-ram-smd20.png"
            alt="SMD (20)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>PIPS (F)</p>
          <img
            src="figures/alanine-ram-pips.png"
            alt="PIPS (F)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (F)</p>
          <img
            src="figures/alanine-ram-tps-dps-f.png"
            alt="TPS-DPS (F)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (P)</p>
          <img
            src="figures/alanine-ram-tps-dps-p.png"
            alt="TPS-DPS (P)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
      </div>
    </div>
    <br /><br /><br /><br />
    <div class="flex-container">
      <h3>Chignolin</h3>
      <div class="gif-container">
        <div class="img-item">
          <p>Unbiased MD</p>
          <img
            src="figures/chignolin-tica-md.png"
            alt="Unbiased MD"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (10K)</p>
          <img
            src="figures/chignolin-tica-smd-10.png"
            alt="SMD (10K)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>SMD (20K)</p>
          <img
            src="figures/chignolin-tica-smd-20.png"
            alt="SMD (20K)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>PIPS (P)</p>
          <img
            src="figures/chignolin-tica-pips.png"
            alt="PIPS (P)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (P)</p>
          <img
            src="figures/chignolin-tica-tps-dps-p.png"
            alt="TPS-DPS (P)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
        <div class="img-item">
          <p>TPS-DPS (S)</p>
          <img
            src="figures/chignolin-tica-tps-dps-s.png"
            alt="TPS-DPS (S)"
            style="display: block; margin: 0 auto; max-width: 160px"
          />
        </div>
      </div>
    </div>
  </body>
</html>
